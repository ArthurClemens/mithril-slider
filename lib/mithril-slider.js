"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),_hammerjs=require("hammerjs"),_hammerjs2=_interopRequireDefault(_hammerjs),createView=function(ctrl,opts){var contentEl=ctrl.contentEl(),list=ctrl.list(),currentIndex=ctrl.index();return ctrl.groupBy(opts.groupBy||1),contentEl&&ctrl.updateContentSize(contentEl),(0,_mithril2["default"])("div",{"class":["slider",opts["class"]||""].join(" ")},opts.before?(0,_mithril2["default"])(".before",opts.before):null,(0,_mithril2["default"])(".content",{config:function(el,inited,context){if(!inited){ctrl.setContentEl(el);var mc=new _hammerjs2["default"].Manager(el,{});mc.add(new _hammerjs2["default"].Pan({orientation:"vertical"===opts.orientation?_hammerjs2["default"].DIRECTION_VERTICAL:_hammerjs2["default"].DIRECTION_HORIZONTAL,threshold:0})),mc.on("panmove",ctrl.handleDrag),mc.on("panend",ctrl.handleDragEnd),mc.on("panstart",ctrl.handleDragStart),context.onunload=function(){mc.off("panmove",ctrl.handleDrag),mc.off("panend",ctrl.handleDragEnd),mc.off("panstart",ctrl.handleDragStart)}}}},list.map(function(data,listIndex){return opts.page({data:data,listIndex:listIndex,currentIndex:currentIndex})})),opts.after?(0,_mithril2["default"])(".after",opts.after):null)},slider={};slider.controller=function(){var opts=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],defaultDuration=parseInt(opts.duration,10)||160,index=_mithril2["default"].prop(opts.index||-1),list=opts.pageData();list.then(_mithril2["default"].redraw);var contentEl=_mithril2["default"].prop(),pageSize=0,groupBy=_mithril2["default"].prop(opts.groupBy||1),cancelDragFactor=opts.cancelDragFactor||.2,isVertical="vertical"===opts.orientation,dir=opts.rtl?-1:1,setIndex=function(idx){var oldIndex=index();if(oldIndex!==idx&&(index(idx),_mithril2["default"].redraw(),opts.getState)){var el=contentEl(),page=getPageEl(el,index());opts.getState({index:idx,hasNext:hasNext(),hasPrevious:hasPrevious(),pageEl:page})}},getPageEl=function(el,idx){return el.childNodes[idx]},setTransitionStyle=function(el,value){var style=el.style,createAttrs=function(){var x=isVertical?"0":value+"px",y=isVertical?value+"px":"0",z="0",attrs=[x,y,z].join(", ");return"translate3d("+attrs+")"};style.transform=style["-webkit-transform"]=style["-moz-transform"]=style["-ms-transform"]=createAttrs()},setTransitionDurationStyle=function(duration){contentEl().style["-webkit-transition-duration"]=contentEl().style["transition-duration"]=duration+"ms"},goTo=function(idx,duration){0>idx||idx>list().length-1||(void 0!==duration&&setTransitionDurationStyle(duration),setTransitionStyle(contentEl(),-dir*idx*pageSize),setIndex(idx))},normalizedStep=function(orientation){var idx=index(),size=groupBy(),min=0,max=list().length,next=idx+orientation*size;return next+size>max?max-size:min>next?min:next},updateContentSize=function(el){var page=el.childNodes[0],prop=isVertical?"height":"width";pageSize=page.getBoundingClientRect()[prop],el.style[prop]=list().length*pageSize+"px"},goCurrent=function(){var duration=arguments.length<=0||void 0===arguments[0]?0:arguments[0];updateContentSize(contentEl()),setTransitionDurationStyle(duration),goTo(normalizedStep(0))},goNext=function(){var duration=arguments.length<=0||void 0===arguments[0]?defaultDuration:arguments[0];return setTransitionDurationStyle(duration),goTo(index()<list().length?normalizedStep(1):normalizedStep(0))},goPrev=function(){var duration=arguments.length<=0||void 0===arguments[0]?defaultDuration:arguments[0];return setTransitionDurationStyle(duration),goTo(index()>0?normalizedStep(-1):normalizedStep(0))},hasNext=function(){return index()+groupBy()<list().length},hasPrevious=function(){return index()>0},setContentEl=function(el){contentEl(el),updateContentSize(el),goCurrent(0)},handleDragStart=function(){return setTransitionDurationStyle(0)},handleDrag=function(e){var el=contentEl(),page=getPageEl(el,index()),delta=isVertical?e.deltaY:e.deltaX,origin=isVertical?page.offsetTop:-1===dir?page.offsetLeft-page.parentNode.clientWidth+page.clientWidth:page.offsetLeft;setTransitionStyle(el,delta-origin),e.preventDefault()},calculateTransitionDuration=function(velocity){var el=contentEl(),page=getPageEl(el,index()),width=page.clientWidth,speed=Math.abs(velocity)||1,duration=1/speed*width;return duration>defaultDuration&&(duration=defaultDuration),duration},handleDragEnd=function(e){var duration=calculateTransitionDuration(e.velocity),delta=isVertical?e.deltaY:e.deltaX;Math.abs(delta)>pageSize*groupBy()*cancelDragFactor?0>dir*delta?goNext(duration):goPrev(duration):goCurrent(duration)};return{list:list,contentEl:contentEl,setContentEl:setContentEl,handleDrag:handleDrag,handleDragStart:handleDragStart,handleDragEnd:handleDragEnd,groupBy:groupBy,updateContentSize:updateContentSize,index:index,hasNext:hasNext,hasPrevious:hasPrevious,goTo:goTo,goCurrent:goCurrent,goNext:goNext,goPrevious:goPrev}},slider.view=function(ctrl,opts){return opts.sliderController&&opts.sliderController(ctrl),createView(ctrl,opts)},exports["default"]=slider;
//# sourceMappingURL=mithril-slider.js.map