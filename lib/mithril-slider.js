"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),_hammerjs=require("hammerjs"),_hammerjs2=_interopRequireDefault(_hammerjs),createView=function(t,e){var n=t.contentEl(),r=t.list(),a=t.index();return t.groupBy(e.groupBy||1),n&&t.updateContentSize(n),(0,_mithril2.default)("div",{class:["slider",e.class||""].join(" ")},e.before?(0,_mithril2.default)(".before",e.before):null,(0,_mithril2.default)(".content",{config:function(r,a,i){if(!a){t.setContentEl(r);var n=new _hammerjs2.default.Manager(r,{});n.add(new _hammerjs2.default.Pan({orientation:"vertical"===e.orientation?_hammerjs2.default.DIRECTION_VERTICAL:_hammerjs2.default.DIRECTION_HORIZONTAL,threshold:0})),n.on("panmove",t.handleDrag),n.on("panend",t.handleDragEnd),n.on("panstart",t.handleDragStart),i.onunload=function(){n.off("panmove",t.handleDrag),n.off("panend",t.handleDragEnd),n.off("panstart",t.handleDragStart)}}}},r.map(function(t,n){return e.page({data:t,listIndex:n,currentIndex:a})})),e.after?(0,_mithril2.default)(".after",e.after):null)},slider={};slider.controller=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],d=parseInt(e.duration,10)||160,t=_mithril2.default.prop(e.index||-1),r=e.pageData();r.then(_mithril2.default.redraw);var n=_mithril2.default.prop(),l=0,u=_mithril2.default.prop(e.groupBy||1),j=e.cancelDragFactor||.2,a="vertical"===e.orientation,m=e.rtl?-1:1,x=function(r){var a=t();if(a!==r&&(t(r),_mithril2.default.redraw(),e.getState)){var i=n(),o=f(i,t());e.getState({index:r,hasNext:_(),hasPrevious:D(),pageEl:o})}},f=function(t,e){return t.childNodes[e]},g=function(n,e){var t=n.style,r=function(){var t=a?"0":e+"px",n=a?e+"px":"0",r="0",i=[t,n,r].join(", ");return"translate3d("+i+")"};t.transform=t["-webkit-transform"]=t["-moz-transform"]=t["-ms-transform"]=r()},o=function(t){n().style["-webkit-transition-duration"]=n().style["transition-duration"]=t+"ms"},s=function(t,e){0>t||t>r().length-1||(void 0!==e&&o(e),g(n(),-m*t*l),x(t))},i=function(o){var l=t(),e=u(),a=0,i=r().length,n=l+o*e;return n+e>i?i-e:a>n?a:n},c=function(t){var n=t.childNodes[0],e=a?"height":"width";l=n.getBoundingClientRect()[e],t.style[e]=r().length*l+"px"},h=function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];c(n()),o(t),s(i(0))},p=function(){var e=arguments.length<=0||void 0===arguments[0]?d:arguments[0];return o(e),s(t()<r().length?i(1):i(0))},v=function(){var e=arguments.length<=0||void 0===arguments[0]?d:arguments[0];return o(e),s(t()>0?i(-1):i(0))},_=function(){return t()+u()<r().length},D=function(){return t()>0},C=function(t){n(t),c(t),h(0)},E=function(){return o(0)},w=function(r){var i=n(),e=f(i,t()),o=a?r.deltaY:r.deltaX,l=a?e.offsetTop:-1===m?e.offsetLeft-e.parentNode.clientWidth+e.clientWidth:e.offsetLeft;g(i,o-l),r.preventDefault()},y=function(r){var a=n(),i=f(a,t()),o=i.clientWidth,l=Math.abs(r)||1,e=1/l*o;return e>d&&(e=d),e},I=function(t){var e=y(t.velocity),n=a?t.deltaY:t.deltaX;Math.abs(n)>l*u()*j?0>m*n?p(e):v(e):h(e)};return{list:r,contentEl:n,setContentEl:C,handleDrag:w,handleDragStart:E,handleDragEnd:I,groupBy:u,updateContentSize:c,index:t,hasNext:_,hasPrevious:D,goTo:s,goCurrent:h,goNext:p,goPrevious:v}},slider.view=function(e,t){return t.sliderController&&t.sliderController(e),createView(e,t)},exports.default=slider,module.exports=exports.default;